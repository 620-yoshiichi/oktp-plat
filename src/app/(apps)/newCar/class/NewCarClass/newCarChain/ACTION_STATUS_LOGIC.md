<!-- # アクションステータス判定ロジック解説 -->

## 概要

新車の進捗管理において、3つのマイルストーン（m2 → m1 → m0）の状態を判定しています。
各マイルストーンには以下の5つのステータスがあります：

| ステータス     | 意味                                   |
| -------------- | -------------------------------------- |
| `生産予定未定` | まだ対象外（前提条件を満たしていない） |
| `対象`         | 対応が必要な状態                       |
| `未活動`       | 対象だが、まだ活動していない           |
| `対処済み`     | 対応完了                               |
| `遅れ`         | 期限を過ぎている（m1, m0のみ）         |

---

## 2ヶ月前ステータスの判定

```
2ヶ月前突入あり？
├─ YES → 対応日が入力済み？
│        ├─ YES → 「対処済み」
│        └─ NO  → 1ヶ月前突入もある？
│                 ├─ YES → 「未活動」
│                 └─ NO  → 「対象」
└─ NO  → 「生産予定未定」
```

### わかりやすく言うと

1. そもそもm2のアラートが出ていなければ「生産予定未定」
2. アラートが出ていて、対応日が記録されていれば「対処済み」
3. 対応日がなく、次の1ヶ月前突入も出ていれば「未活動」（先に進んでしまった）
4. 対応日がなく、1ヶ月前突入もなければ「対象」（今やるべき）

---

## 1ヶ月前ステータスの判定

```
1ヶ月前突入（アラート）あり？
├─ YES → 書類期限(m1_deadline_paper)と入金期限(m1_deadline_money)の両方が設定済み？
│        ├─ YES → 本部書類完備が未入力で、かつ期限超過？
│        │        ├─ YES → 「遅れ」
│        │        └─ NO  → 「対処済み」
│        └─ NO  → フレーム番号(DD_FR)がある？
│                 ├─ YES → 「未活動」
│                 └─ NO  → 「対象」
└─ NO  → 「生産予定未定」
```

### わかりやすく言うと

1. 1ヶ月前突入がなければ「生産予定未定」
2. 期限が設定されている場合：
   - 本部承諾がまだで期限を過ぎていたら「遅れ」
   - それ以外は「対処済み」
3. 期限が未設定の場合：
   - フレーム番号があれば「未活動」
   - なければ「対象」

---

## 振当時ステータスの判定

```
DD_FR（振当日）あり？
├─ YES → 納車期限(m0_deadline_nousya)が設定済み？
│        ├─ YES → 納車日(DD_NOSYA)がNULLで、かつ期限超過？
│        │        ├─ YES → 「遅れ」
│        │        └─ NO  → 「対処済み」
│        └─ NO  → 納車日(DD_NOSYA)がある？
│                 ├─ YES → 「未活動」
│                 └─ NO  → 「対象」
└─ NO  → 「生産予定未定」
```

### わかりやすく言うと

1. フレーム番号がなければ「生産予定未定」
2. 納車期限が設定されている場合：
   - まだ納車されておらず期限を過ぎていたら「遅れ」
   - それ以外は「対処済み」
3. 納車期限が未設定の場合：
   - 納車日があれば「未活動」
   - なければ「対象」

---
